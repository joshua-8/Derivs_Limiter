<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Derivs Limiter: Derivs_Limiter</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Derivs Limiter
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title"><a class="el" href="class_derivs___limiter.html" title="This library can be used to limit the first and second derivative of a variable as it approaches a ta...">Derivs_Limiter</a> </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="anchor" id="md_README"></a> <a href="https://github.com/joshua-8/Derivs_Limiter">https://github.com/joshua-8/Derivs_Limiter</a></p>
<p ><a href="https://www.ardu-badge.com/Derivs_Limiter"><img src="https://www.ardu-badge.com/badge/Derivs_Limiter.svg?" alt="arduino-library-badge" style="pointer-events: none;" class="inline"/></a> <a href="https://registry.platformio.org/libraries/joshua1024/Derivs_Limiter"><img src="https://badges.registry.platformio.org/packages/joshua1024/library/Derivs_Limiter.svg" alt="PlatformIO" style="pointer-events: none;" class="inline"/></a></p>
<p ><a href="https://joshua-8.github.io/Derivs_Limiter/class_derivs___limiter.html">DETAILED DOCUMENTATION</a> (made with Doxygen)</p>
<p >Please ask any questions <a href="https://github.com/joshua-8/Derivs_Limiter/discussions">here</a>.</p>
<p >This library can be used to limit the first and second derivative of a variable as it approaches a target value.</p>
<p >It's easiest to think of in terms of position, velocity, and acceleration. If used with a servo, for example, the servo will smoothly move to a target value with a trapezoidal velocity profile.</p>
<p >You can also specify how long you want a move to take and the library can calculate the velocity needed to make that happen.</p>
<p >The formula in this program supports being run at uneven intervals, and allows for editing the target, position, and velocity while it runs since it doesn't rely on calculating a motion profile ahead of time.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Usage:</h1>
<h2><a class="anchor" id="autotoc_md2"></a>
Create a Derivs_Limiter object:</h2>
<p ><code><a class="el" href="class_derivs___limiter.html" title="This library can be used to limit the first and second derivative of a variable as it approaches a ta...">Derivs_Limiter</a> myLimiter = <a class="el" href="class_derivs___limiter.html" title="This library can be used to limit the first and second derivative of a variable as it approaches a ta...">Derivs_Limiter(velocityLimit, accelLimit)</a>;</code></p>
<p >`Derivs_Limiter(float _velLimit, float _accelLimit, float _decelLimit = NAN, float _target = 0, float _startPos = 0, float _startVel = 0, bool _preventGoingWrongWay = false, bool _preventGoingTooFast = false, float _posLimitLow = -INFINITY, float _posLimitHigh = INFINITY, float _maxStoppingDecel = 2, float* _posPointer = NULL, float* _velPointer = NULL)</p>
<p ><em><b>Velocity, position and/or acceleration limits can be set as INFINITY in order to have no limit.</b></em></p>
<h2><a class="anchor" id="autotoc_md3"></a>
quick reference: (&lt;a href="https://joshua-8.github.io/Derivs_Limiter/html/class_derivs___limiter.html" &gt;more detailed reference available here&lt;/a&gt;)</h2>
<pre class="fragment">// all settings of constructor

limiter.setVelLimit(10);
limiter.setAccelLimit(5);
limiter.setDecelLimit(NAN);
limiter.setTarget(0);
limiter.setPosition(0);
limiter.setVelocity(0);
limiter.setPreventGoingWrongWay(false);
limiter.setPreventGoingTooFast(false);
limiter.setLowPosLimit(-INFINITY);
limiter.setHighPosLimit(INFINITY);
limiter.setMaxStoppingDecel(2);
limiter.setPositionPointer(NULL);
limiter.setVelocityPointer(NULL);

/// settings grouped together for your convenience

limiter.setPositionVelocity(0, 0); // position, velocity
limiter.setTargetAndPosition(0, 0); // target, position
limiter.setAccelAndDecelLimits(1, NAN); // accel, decel
limiter.setVelAccelLimits(1, 1, 1); // vel, accel, decel
limiter.setPosLimits(-INFINITY, INFINITY); // low limit, high limit
limiter.setPositionAndTarget(0); // both position and target get set to the same value

// get output

limiter.getPosition();
limiter.getVelocity();
limiter.getAcceleration();

// get settings

limiter.getTarget();
limiter.getVelLimit();
limiter.getAccelLimit();
limiter.getDecelLimit();
limiter.getMaxStoppingDecel();
limiter.getLowPosLimit();
limiter.getHighPosLimit();

// other
limiter.jogPosition(1); // increments target and position
limiter.resetTime();
limiter.getLastTime();
limiter.getTimeInterval();
limiter.getTargetDelta();
limiter.getLastTarget();
limiter.getPositionDelta();
limiter.getLastPosition();
limiter.getTargetDeltaPerTime();
limiter.getPreventGoingWrongWay();
limiter.getPreventGoingTooFast();
limiter.isPosAtTarget();
limiter.isPosNotAtTarget();
limiter.distToTarget();

// velocity mode

limiter.setVelConstant(1); // sets velocity immediately
limiter.setVelTarget(1); // velocity approaches the set target with limited accel and decel
limiter.isPosModeNotVelocity();
limiter.getVelTarget();

// timed moves

limiter.setVelLimitForTimedMove(20, 5, NAN); // dist, time, maxVel
limiter.setTargetAndVelLimitForTimedMove(10, 5, NAN); // target, time, maxVel
limiter.setTargetTimedMovePreferred(10, 5, NAN); // target, time, maxVel
limiter.resetVelLimitToOriginal();
</pre><h1><a class="anchor" id="autotoc_md4"></a>
Notes:</h1>
<p >During the part of the profile where velocity is decreased, the acceleration is a bit "spiky" as the code switches back and forth across the threshold for whether or not it needs to start decelerating. Acceleration should not be used directly, only position and velocity are really valid. (Also, note that if the deceleration limit is infinity, this value stays zero when position stops)</p>
<p >NAN (not a number) values are ignored.</p>
<p ><a href="https://gist.github.com/joshua-8/3209f2f400a0e68dead911b8743fc5f0">Here</a> is a Processing sketch that I used to test the formula I wrote for this library. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4
</small></address>
</body>
</html>
